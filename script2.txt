document.addEventListener("DOMContentLoaded", async function() {
    const categoriasLista = document.getElementById("categorias-lista");
    const preguntasLista = document.getElementById("preguntas-lista");

    // Obtener las categorías de trivia
    try {
        const response = await fetch("https://opentdb.com/api_category.php");
        const data = await response.json();

        if (data.trivia_categories && data.trivia_categories.length > 0) {
            data.trivia_categories.forEach((categoria) => {
                const categoriaDiv = document.createElement("div");
                categoriaDiv.classList.add("categoria");
                categoriaDiv.textContent = categoria.name;
                categoriaDiv.onclick = () => obtenerPreguntas(categoria.id);
                categoriasLista.appendChild(categoriaDiv);
            });
        } else {
            categoriasLista.innerHTML = "<p>No se pudieron obtener las categorías. Intenta nuevamente más tarde.</p>";
        }
    } catch (error) {
        categoriasLista.innerHTML = "<p>Hubo un error al conectar con la API.</p>";
        console.error(error);
    }

    // Función para obtener las preguntas
    async function obtenerPreguntas(categoriaId) {
        preguntasLista.innerHTML = ""; // Limpiar las preguntas anteriores

        try {
            const response = await fetch(`https://opentdb.com/api.php?amount=5&category=${categoriaId}`);
            const data = await response.json();

            if (data.results && data.results.length > 0) {
                data.results.forEach((pregunta, index) => {
                    const preguntaDiv = document.createElement("div");
                    preguntaDiv.classList.add("pregunta");

                    const titulo = document.createElement("h2");
                    titulo.textContent = `${index + 1}. ${pregunta.question}`;
                    preguntaDiv.appendChild(titulo);

                    const opciones = [...pregunta.incorrect_answers, pregunta.correct_answer];
                    opciones.sort(() => Math.random() - 0.5); // Mezclar las opciones

                    const opcionesDiv = document.createElement("div");
                    opcionesDiv.classList.add("opciones");

                    opciones.forEach((opcion) => {
                        const opcionDiv = document.createElement("div");
                        opcionDiv.classList.add("opcion");
                        opcionDiv.textContent = opcion;
                        opcionDiv.onclick = () => verificarRespuesta(opcion, pregunta.correct_answer, opcionDiv);
                        opcionesDiv.appendChild(opcionDiv);
                    });

                    preguntaDiv.appendChild(opcionesDiv);
                    preguntasLista.appendChild(preguntaDiv);
                });
            } else {
                preguntasLista.innerHTML = "<p>No se pudieron obtener preguntas. Intenta nuevamente más tarde.</p>";
            }
        } catch (error) {
            preguntasLista.innerHTML = "<p>Hubo un error al conectar con la API para obtener las preguntas.</p>";
            console.error(error);
        }
    }

    // Función para verificar la respuesta
    function verificarRespuesta(opcionSeleccionada, respuestaCorrecta, opcionDiv) {
        if (opcionSeleccionada === respuestaCorrecta) {
            opcionDiv.classList.add("correcta");
        } else {
            opcionDiv.classList.add("incorrecta");
        }
    }

    // Función para cambiar entre pestañas
    function openTab(evt, tabName) {
        const tabContents = document.querySelectorAll(".tab-content");
        const tabLinks = document.querySelectorAll(".tab-link");

        tabContents.forEach(content => content.classList.remove("active"));
        tabLinks.forEach(link => link.classList.remove("active"));

        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");
    }

    // Inicializar la pestaña activa por defecto
    document.querySelector(".tab-link.active").click();
});

  